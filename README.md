# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных 

Товар

```
export interface IProduct {
    id: string;
    image: string;
    description: string;
    title: string;
    category: string;
    price: number;
}
```

Пользовательска информация

```
export interface IUser {
    address: string;
    email: string;
    phone:string;
    payment: string;
    total: number;
    items: string[] | null;
}
```

Данные, используемые в форме выбора оплаты и адреса

```
export type IUserChoosePayment = Pick<IUser, 'payment' | 'addr'>;
```

Данные, используемые в форме ввода почты и телефона

```
export type IUserEnterEmail = Pick<IUser, 'email' | 'phone'>; 
```

Данные, используемые для проверки валидации

```
export type IUserValid = Pick<IUser, 'email' | 'phone' | 'address' | 'payment'>; 
```

## Архитектура

Код приложения написан согласно парадигме MVP:
- слой данных, отвечает за хранение и измнения данных;
- слой представления, отвечает за отображения данных ;
- презентер, отвечат за связь данных и отображения.

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.
 

### Базовый код

#### Класс Api
Предназваничен для взаимодейтсвия с сервером.

Конструктом принимает следующие аргументы:
- baseUrl: string - адрес сервера
- options: RequestInit - заголовки запроса

Класс содержит следующие методы:
- handleResponse(response: Response): Promise<object> - отвечает за проверку ответа от сервера. 
- get(uri: string) - отвечает за принятие данных с сервера
- post(uri: string, data: object, method: ApiPostMethods = 'POST') - отвечает за отправление запросов на сервер

#### Класс Events
Является брокером событий.

Содержит поле, которое отвечает за название действия и его функцию.

Ключевые методы:
- on<T extends object>(eventName: EventName, callback: (event: T) => void) - установить обработчик на событие
- emit<T extends object>(eventName: string, data?: T) - Инициировать событие с данными
- trigger<T extends object>(eventName: string, context?: Partial<T>) - Сделать коллбек триггер, генерирующий событие при вызове


### Класс для работы с API

#### Класс AppAPI
Необходим для типизации ответов и запросов на сервер.
В констуктор принимает ссылку на сервер, а также часть ссылки для корректного отображения картинок. 

Методы:
- getProducts(): Promise<IProduct[]> - возврщает полученные с сервера товары
- order(data: IUser): Promise<IUser> - возвращает ответ с сервера о статусе покупки


### Классы данных

#### Класс Catalog

Класс отвечает за хранение и логику работы с карточками.
Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- products: IProduct[] - массив объектов товаров
- curProduct: string | null - id товара, выбранного для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- get и set products - для установки и получения товаров
- set curProduct - для установки выбранного товара
- getProductFromCatalog(id: string): void - возвращает карточку по id.

#### Класс UserData

Класс отвечает за хранение и логику работы с данными  пользователя.
Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
- address: string - адрес пользователя
- email: string - почта пользоватя
- phone: string - телефон пользоватя
- payment: string - оплата пользоватя
- products: string[] - id товаров пользоватя
- total: number - сумма купленных товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс описывает набор методов для взаимодействия с данными пользователя.
- setTotal(total: number) - устанавливает сумму заказа
- getUserData(): IUser - для получения объекта заказа
- setUserProducts(ids: string[]): void - сохраняет покупаемые товары
- checkContactsValidation(): boolean - проверяет объект с контактами пользователя на валидность
- checkOrderValidation(): boolean - проверяет объект с заказом пользователя на валидность
- checkField(data: {field: keyof IUserValid, value: string}) - проверяет поле на валидность
- checkEmail(value: string) - проверяет введеную почту на валидность
- checkPhone(value: string) - проверяет введенный телефон на валидность
- checkAddr(value: string) - проверяет введенный адрес на валидность
- checkPayment(value: string) - проверяет введенный тип оплаты на валидность


#### Класс Basket

Класс отвечает за хранение и логику работы с корзиной товаров
Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
- _products: IProduct[] - товары корзины
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс описывает набор методов для взаимодействия с корзиной.
- addProductToBaseket(product: IProduct): void - добавить товар в корзину;
- deleteProductFromBaseket(id: string): void - удалить товар из корзины;
- getProductsFromBasket(): IProduct[] - получить списко товаров из корзины;
- getTotalFromBasket(): number - получить обшую сумму товаров корзины;
- getProductsIdsFromBasket(): string[] - для получения id покупаемых товаров
- isBasketHaveProducts() - для проверки корзины на наличие товаров
- getCountProductsFromBasket(): number - получить количество товаров в корзине;
- clearBasket(): void - очистить корзину;


### Базовые классы

#### Класс Component<T>
Отвечает за общую функцоинальность отображений.
Конструктор класса принимает HTMLElement объекта.

Методы класса:
- render(data?: Partial<T>): HTMLElement - отобржает изменение на странице

#### Form<T>
Расширяет класс Component.
Отвечает функциональность формы.
Конструктор принимает HTMLElement и объект брокера событий.

Поля класса:
- inputs: HTMLInputElement[] - массив полей ввода
- submitButton: HTMLButtonElement - кнопка submit формы
- modalActions: HTMLDivElement - div элемент кпонки submit и span'а для ошибок
- formName - значение атрибута name формы
- _error: HTMLElement - элемент для вывода ошибок

Методы класса: 
- submitForm(evt: MouseEvent) - действия при submit формы
- getInputValues() - возвращает введенные данные в инпуты
- set error(text: string) - выводит в span текст ошибки
- set valid(isValid: Boolean) - включает и отключает кнопку submit

### Классы отображения

#### Класс Page
Расширяет класс Component. Реализует главную страницу.
Конструктор класса получает базовый элемент разметки и инстанс брокера событий.

Содерижт следующие поля:
- _catalog: HTMLElement - элемент в котором отобрада.тся карточки
- _miniBasket: HTMLButtonElement - кнопка открытия корзины
- _counter: HTMLElement - элемент вывода количества товаров в корзине
- _wrapper: HTMLElement - обертка для отключения скрола при открытии модалки

Содержит следующие методы:
- set counter(count: string) - устанавливает количество товаров в корзине
- set catalog(items: HTMLElement[]) - выводит каталог товаров
- set locked(value: boolean) - блокирует скролл


#### Класс Product
Расщиряет класс Component. Реализует элемент товара.
Констркутор класса получает экземпляр брокера событий и HTMLElement карточки.

Содерижт следующие поля:
- cardTitle: HTMLElement;
- cardText: HTMLElement;
- cardPrice: HTMLElement;
- cardImage: HTMLImageElement;
- cardId: string;
- cardCategory: HTMLElement;
- previewButton: HTMLButtonElement;
- basketButton: HTMLButtonElement;

Методы класса:
содержит геттеры и сеттеры для установки всех элементов товара

#### Класс Modal
Расширяет класс Component. Реализует модальное окно. Позволяет открыть соответсвующее содержимое темплейта в модально окно. Также предоставляет методы открытия и закрытия модального окна. 
Конструктом класса получает селектор HTML разметки, а также экземпляр класса `EventEmitter`.

Поля класса:
- closeButton: HTMLButtonElement - кнопка закрытия модалки
- dataContainer: HTMLElement - элемент куда вставляется содержимое модалки
- events: IEvents - брокер событий

Методы:
- render(): HTMLElement - возвращает модалку с установленными слушателями
- set item(item: HTMLElement) - устанавливает содержимое модалки
- openModal() - открывает модалку 
- closeModal() - закрывает модалку

#### Класс BasketView
Расширяет класс Component. Реализует корзину.
Конструктор класса получает базовый элемент разметки и объект брокера событий.

Содерижт следующие поля:
- basketList : HTMLElement - элемент для отображения товаров
- basketPrice : HTMLElement - элемент для отображения общей цены товаров
- basketBuyButton : HTMLButtonElement - кнопка оформления


Методы:
- set price(price: number) - выводит общую цены товаров корзины
- set catalog(items: HTMLElement[]) - выводит товары в корзину
- set basketBuyButtonState(value: boolean) - устанавливает состояние кнопки оформления

#### Класс FormOrder
Расширяет класс Form. Реализует форму ввода почты и адреса.
Конструктор класса получает базовый элемент разметки и объект брокера событий.

Поля класса: 
- buttons: HTMLButtonElement[] - кнопки выбора оплаты 

Методы:
- resetBtns() - сбрасывает выбранный способ оплаты
- getInputValues() - возращает введенные значения

#### Класс ChoosFormContactsePayment
Расширяет класс Form. Реалиузет формы выбора оплаты и ввода адреса.
Конструктор класса получает базовый элемент разметки и объект брокера событий.

#### Класс Succes
Расширяет класс Component. Реализует разметку успешной оплаты.
Конструктор класса получает базовый элемент разметки и брокер событий.

Содерижт следующие поля:
- priceElement : HTMLElement - элемент для вывода суммы оплаты
- button: HTMLButtonElement - кнопка подтверждения

Методы:
- set price(price: string) - выводит суммы покупки


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `basket:changed` - изменяет количество товаров корзины
- `user:addProducts'` - добавление товаров в заказ
- `products:add` - добавление товаров на страницу
- `product:selected` - выбор товара для просмотра его в модалке


*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:buy` - переход к форме ввода адреса и оплаты
- `{formName}: input` - проверка пользовательского ввода на конкретной форме
- `{formName}:fill` - переход к следущему шагу после успешного введния данных в формк
- `basket:open` - открытие корзины с товарами
- `baseket:add` - добавление товара в корзину
- `baseket:delete` - удаление товара из корзину
- `product:select` - просмотр подробной информации о товаре
- `succes:close` - подтверждения успешной оплаты заказа